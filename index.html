<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ”’ Ø¯Ø®ÙˆÙ„ Ù…Ø­Ù…ÙŠ</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  :root{
    --bg1:#0f1724;
    --card:#fff;
    --accent:#2A9DF4;
    --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg,#071122 0%, #0b2540 100%);
    font-family: "Segoe UI", Roboto, Arial, sans-serif; color:var(--muted);
  }
  .wrap{width:100%;max-width:720px;padding:20px}
  .card{
    background:var(--card); border-radius:14px; padding:28px; box-shadow:0 12px 40px rgba(2,6,23,0.6);
    color:#0b1720; text-align:center;
  }
  h1{margin:0 0 8px 0; font-size:20px; color:var(--accent)}
  p.lead{margin:0 0 18px 0;color:#374151}
  .status{margin-top:12px;font-size:15px}
  .error { color:#b91c1c; font-weight:700; font-size:16px; }
  .buttons{display:flex;gap:12px;justify-content:center;margin-top:18px;flex-wrap:wrap}
  .btn{padding:10px 16px;border-radius:10px;text-decoration:none;color:white;font-weight:700}
  .tg{background:#2AABEE}
  .inst{background:#E1306C}
  .ghost{background:#f3f4f6;color:#0b1220;border:1px solid #e6eef9}
  .small{font-size:13px;color:#475569;margin-top:10px}
  @media (max-width:520px){
    .card{padding:18px}
    h1{font-size:18px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <h1>ğŸ”’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h1>
      <p class="lead">ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø³Ø§Ø¨Ùƒ. Ø§ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Ø¯Ø§Ø®Ù„ Ø¨ÙˆØª ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ø­ØªÙ‰ ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ­Ù‚Ù‚.</p>

      <div id="mainStatus" class="status">â³ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>

      <div id="actions" style="display:none" class="buttons">
        <a id="tgBtn" class="btn tg" href="https://t.me/hx_ed" target="_blank" rel="noopener">ğŸ“© Ù…Ø±Ø§Ø³Ù„Ø© Ø¹Ø¨Ø± ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…</a>
        <a id="igBtn" class="btn inst" href="https://www.instagram.com/hamedareqi" target="_blank" rel="noopener">ğŸ“¸ Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…</a>
        <a id="retry" class="btn ghost" href="#" onclick="window.location.reload();return false;">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</a>
      </div>

      <div id="note" class="small">Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© Ø±ÙØ¶: ØªÙˆØ§ØµÙ„ Ù…Ø¹ÙŠ Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù†.</div>
    </div>
  </div>

<script>
  (function(){
    const mainStatus = document.getElementById('mainStatus');
    const actions = document.getElementById('actions');

    // Raw JSON file (Ø§Ø³ØªØ®Ø¯Ù… Ø±Ø§Ø¨Ø·Ùƒ ÙƒÙ…Ø§ ÙˆØ¶Ø¹ØªÙ‡)
    const allowedJSON = "https://raw.githubusercontent.com/hamedareqi/EnglishQuiz/refs/heads/main/allowed.json";

    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒØ§Ø¦Ù† Telegram WebAppØ› Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¯Ø§Ø®Ù„ TelegramØŒ Ø³Ù†Ø¶Ø¹ user = null
    let tg = null;
    try { tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null; } catch(e){ tg = null; }

    // Helper Ù„ØªØ¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
    function showDenied(msg){
      mainStatus.innerHTML = `<span class="error">âŒ ${msg}</span>`;
      actions.style.display = 'flex';
    }

    // Ø¥Ø°Ø§ Ù„Ù… ØªÙÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¯Ø§Ø®Ù„ Telegram WebApp
    if(!tg){
      mainStatus.innerText = "âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙÙØªØ­ Ù…Ù† Ø¯Ø§Ø®Ù„ ØªØ·Ø¨ÙŠÙ‚ Telegram (WebApp).";
      actions.style.display = 'flex';
      return;
    }

    // ØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨ Ù„Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„
    try{ tg.expand(); }catch(e){}

    // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† WebApp (ØºÙŠØ± Ù…ÙˆÙ‚Ø¹Ø©)
    const user = tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
    if(!user){
      showDenied("Ù„Ù… Ù†Ø³ØªØ·Ø¹ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Telegram. Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨ÙˆØª.");
      return;
    }

    mainStatus.innerText = `ğŸ” Ù†ØªØ­Ù‚Ù‚ Ù…Ù† ID: ${user.id} â€” ${user.first_name || ''}`;

    // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù… Ù…Ù† GitHub
    fetch(allowedJSON, {cache: "no-store"})
      .then(res => {
        if(!res.ok) throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ù…Ù„Ù Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª");
        return res.json();
      })
      .then(json => {
        const ids = Array.isArray(json.allowed_ids) ? json.allowed_ids.map(id => Number(id)) : [];
        if(ids.includes(Number(user.id))){
          // Ù…Ø³Ù…ÙˆØ­ â†’ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
          mainStatus.innerHTML = `âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ â€” Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒâ€¦`;
          // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø«Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
          setTimeout(()=> {
            // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ welcome.html Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹/Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø³ØªØ¶Ø§ÙØ©
            // ØªØ£ÙƒØ¯ Ø£Ù† welcome.html ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§Ø± Ø¹Ù„Ù‰ GitHub Pages Ø£Ùˆ Ø§Ø³ØªØ¶Ø§ÙØªÙƒ
            window.location.href = "welcome.html";
          }, 700);
        } else {
          showDenied("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø¥Ø°Ù† Ù„Ù„ÙˆØµÙˆÙ„. ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø°Ù†.");
        }
      })
      .catch(err => {
        console.error(err);
        showDenied("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§.");
      });

  })();
</script>
</body>
</html>
